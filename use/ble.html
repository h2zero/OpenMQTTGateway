<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BLE gateway | OpenMQTTGateway test-docs</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" href="/img/Openmqttgateway_logo_mini.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script type="module" src="https://unpkg.com/esp-web-tools@9/dist/web/install-button.js?module"></script>
    <meta name="description" content="One gateway, many technologies: MQTT gateway for ESP8266, ESP32, Sonoff RF Bridge or Arduino with bidirectional 433mhz/315mhz/868mhz, Infrared communications, BLE, beacons detection, mi flora / mi jia / LYWSD02/ Mi Scale compatibility, SMS &amp; LORA.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/favicon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.c6986814.css" as="style"><link rel="preload" href="/assets/js/app.a95c5609.js" as="script"><link rel="preload" href="/assets/js/2.42b808dd.js" as="script"><link rel="preload" href="/assets/js/9.ff7eeaa8.js" as="script"><link rel="prefetch" href="/assets/js/10.d521069e.js"><link rel="prefetch" href="/assets/js/100.e7906c2f.js"><link rel="prefetch" href="/assets/js/101.bdc45c3f.js"><link rel="prefetch" href="/assets/js/102.5a61a41e.js"><link rel="prefetch" href="/assets/js/103.3419a264.js"><link rel="prefetch" href="/assets/js/104.355c6485.js"><link rel="prefetch" href="/assets/js/105.18fd55c3.js"><link rel="prefetch" href="/assets/js/106.f210183b.js"><link rel="prefetch" href="/assets/js/107.9149ba4f.js"><link rel="prefetch" href="/assets/js/108.6723924a.js"><link rel="prefetch" href="/assets/js/109.fa143058.js"><link rel="prefetch" href="/assets/js/11.b9695787.js"><link rel="prefetch" href="/assets/js/110.77af1a9e.js"><link rel="prefetch" href="/assets/js/111.22de4e78.js"><link rel="prefetch" href="/assets/js/112.98378493.js"><link rel="prefetch" href="/assets/js/113.51728c54.js"><link rel="prefetch" href="/assets/js/114.934e0a98.js"><link rel="prefetch" href="/assets/js/115.95e9dd8f.js"><link rel="prefetch" href="/assets/js/116.0b78f583.js"><link rel="prefetch" href="/assets/js/117.ad4f1e3a.js"><link rel="prefetch" href="/assets/js/118.ceb24680.js"><link rel="prefetch" href="/assets/js/119.979c94d0.js"><link rel="prefetch" href="/assets/js/12.2ce1a9b7.js"><link rel="prefetch" href="/assets/js/13.e84d8b48.js"><link rel="prefetch" href="/assets/js/14.2e018f36.js"><link rel="prefetch" href="/assets/js/15.b9066a0b.js"><link rel="prefetch" href="/assets/js/16.83325ed9.js"><link rel="prefetch" href="/assets/js/17.493f7019.js"><link rel="prefetch" href="/assets/js/18.5c1e89dc.js"><link rel="prefetch" href="/assets/js/19.53b9bbaa.js"><link rel="prefetch" href="/assets/js/20.2543b790.js"><link rel="prefetch" href="/assets/js/21.8c2da22c.js"><link rel="prefetch" href="/assets/js/22.54b64de7.js"><link rel="prefetch" href="/assets/js/23.464cd69a.js"><link rel="prefetch" href="/assets/js/24.7a107ef4.js"><link rel="prefetch" href="/assets/js/25.8841bf9c.js"><link rel="prefetch" href="/assets/js/26.d4c3b863.js"><link rel="prefetch" href="/assets/js/27.d71c8b76.js"><link rel="prefetch" href="/assets/js/28.98bd5bda.js"><link rel="prefetch" href="/assets/js/29.7cf62a1f.js"><link rel="prefetch" href="/assets/js/3.53bbc8c0.js"><link rel="prefetch" href="/assets/js/30.1e963bda.js"><link rel="prefetch" href="/assets/js/31.3f24dd42.js"><link rel="prefetch" href="/assets/js/32.291c2874.js"><link rel="prefetch" href="/assets/js/33.9fccd94c.js"><link rel="prefetch" href="/assets/js/34.730bd13c.js"><link rel="prefetch" href="/assets/js/35.50b9f803.js"><link rel="prefetch" href="/assets/js/36.58d2c4fd.js"><link rel="prefetch" href="/assets/js/37.a079dc9c.js"><link rel="prefetch" href="/assets/js/38.06afe3c4.js"><link rel="prefetch" href="/assets/js/39.aacf29e1.js"><link rel="prefetch" href="/assets/js/4.18d8df43.js"><link rel="prefetch" href="/assets/js/40.15f9e90a.js"><link rel="prefetch" href="/assets/js/41.b6be8de6.js"><link rel="prefetch" href="/assets/js/42.d079fc1a.js"><link rel="prefetch" href="/assets/js/43.98627f81.js"><link rel="prefetch" href="/assets/js/44.856ebc15.js"><link rel="prefetch" href="/assets/js/45.28208dca.js"><link rel="prefetch" href="/assets/js/46.0e77b5a5.js"><link rel="prefetch" href="/assets/js/47.cb95368b.js"><link rel="prefetch" href="/assets/js/48.3aad73a6.js"><link rel="prefetch" href="/assets/js/49.32a7dc22.js"><link rel="prefetch" href="/assets/js/5.823b1607.js"><link rel="prefetch" href="/assets/js/50.f30527f1.js"><link rel="prefetch" href="/assets/js/51.2335d9c5.js"><link rel="prefetch" href="/assets/js/52.4dedf816.js"><link rel="prefetch" href="/assets/js/53.40d71856.js"><link rel="prefetch" href="/assets/js/54.d811bd6a.js"><link rel="prefetch" href="/assets/js/55.9af13e7d.js"><link rel="prefetch" href="/assets/js/56.234ebd1f.js"><link rel="prefetch" href="/assets/js/57.6bcfd5ba.js"><link rel="prefetch" href="/assets/js/58.3adeb87a.js"><link rel="prefetch" href="/assets/js/59.6d6332d5.js"><link rel="prefetch" href="/assets/js/6.4c0e15aa.js"><link rel="prefetch" href="/assets/js/60.2bbb7b05.js"><link rel="prefetch" href="/assets/js/61.dd71a243.js"><link rel="prefetch" href="/assets/js/62.14178adb.js"><link rel="prefetch" href="/assets/js/63.77703d24.js"><link rel="prefetch" href="/assets/js/64.6c92c944.js"><link rel="prefetch" href="/assets/js/65.3d3a9ca5.js"><link rel="prefetch" href="/assets/js/66.13773a9a.js"><link rel="prefetch" href="/assets/js/67.47e788b7.js"><link rel="prefetch" href="/assets/js/68.33c713ad.js"><link rel="prefetch" href="/assets/js/69.5b37570e.js"><link rel="prefetch" href="/assets/js/7.0bb58956.js"><link rel="prefetch" href="/assets/js/70.9579ddb5.js"><link rel="prefetch" href="/assets/js/71.257fca55.js"><link rel="prefetch" href="/assets/js/72.52b5fe33.js"><link rel="prefetch" href="/assets/js/73.7c439250.js"><link rel="prefetch" href="/assets/js/74.15a5b98f.js"><link rel="prefetch" href="/assets/js/75.6019a4a3.js"><link rel="prefetch" href="/assets/js/76.68e11398.js"><link rel="prefetch" href="/assets/js/77.624cd4da.js"><link rel="prefetch" href="/assets/js/78.65d31021.js"><link rel="prefetch" href="/assets/js/79.850e5e1a.js"><link rel="prefetch" href="/assets/js/8.2b942cac.js"><link rel="prefetch" href="/assets/js/80.e3070510.js"><link rel="prefetch" href="/assets/js/81.8a7b925f.js"><link rel="prefetch" href="/assets/js/82.bd0f2e52.js"><link rel="prefetch" href="/assets/js/83.564ee725.js"><link rel="prefetch" href="/assets/js/84.e869d1f3.js"><link rel="prefetch" href="/assets/js/85.9cb58cee.js"><link rel="prefetch" href="/assets/js/86.0155c28d.js"><link rel="prefetch" href="/assets/js/87.2b7bd38f.js"><link rel="prefetch" href="/assets/js/88.d6113a06.js"><link rel="prefetch" href="/assets/js/89.a7c37ef6.js"><link rel="prefetch" href="/assets/js/90.8d7b30fd.js"><link rel="prefetch" href="/assets/js/91.795306d5.js"><link rel="prefetch" href="/assets/js/92.1bc3353f.js"><link rel="prefetch" href="/assets/js/93.e6120f01.js"><link rel="prefetch" href="/assets/js/94.150bdf30.js"><link rel="prefetch" href="/assets/js/95.382dcc71.js"><link rel="prefetch" href="/assets/js/96.fd11c0fe.js"><link rel="prefetch" href="/assets/js/97.1b7b9cf9.js"><link rel="prefetch" href="/assets/js/98.7706d0ec.js"><link rel="prefetch" href="/assets/js/99.5426b0a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c6986814.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OpenMQTTGateway test-docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://shop.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Shop🆕
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_self" class="nav-link external">
  Devices
  <!----></a></div><div class="nav-item"><a href="/upload/web-install.html" class="nav-link">
  Upload
</a></div><div class="nav-item"><a href="https://app.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Theengs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://shop.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Shop🆕
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_self" class="nav-link external">
  Devices
  <!----></a></div><div class="nav-item"><a href="/upload/web-install.html" class="nav-link">
  Upload
</a></div><div class="nav-item"><a href="https://app.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Theengs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">0 - What is it for 🏠</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1 - Prerequisites🧭</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2 - Set it up 🔨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3 - Upload ➡️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>4 - Use ✈️</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/use/rf.html" class="sidebar-link">RF gateways  (433mhz/315mhz)</a></li><li><a href="/use/ble.html" aria-current="page" class="active sidebar-link">BLE gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/use/ble.html#receiving-signals-from-compatible-ble-sensors-to-publish-it-to-an-mqtt-broker" class="sidebar-link">Receiving signals from compatible BLE sensors to publish it to an MQTT broker.</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#receiving-signals-from-ble-tracker-devices-for-presence-detection" class="sidebar-link">Receiving signals from BLE tracker devices for Presence detection</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-a-white-or-black-list" class="sidebar-link">Setting a white or black list</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-time-between-ble-scans-and-force-a-scan" class="sidebar-link">Setting the time between BLE scans and force a scan</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-time-between-connection-attempts" class="sidebar-link">Setting the time between connection attempts</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors-default-false" class="sidebar-link">Setting if the gateway publishes all the BLE devices scanned or only the detected sensors (default: false)</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-publishes-known-devices-which-randomly-change-their-mac-address" class="sidebar-link">Setting if the gateway publishes known devices which randomly change their MAC address</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-use-adaptive-scanning" class="sidebar-link">Setting if the gateway use adaptive scanning</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-time-between-active-scanning" class="sidebar-link">Setting the time between active scanning</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-duration-of-a-scan" class="sidebar-link">Setting the duration of a scan</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32" class="sidebar-link">Setting if the gateway connects to BLE devices eligibles on ESP32</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-publish-into-home-assistant-home-presence-topic" class="sidebar-link">Setting if the gateway publish into Home Assistant Home presence topic</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-uses-ibeacon-uuid-as-topic-instead-of-random-mac-address" class="sidebar-link">Setting if the gateway uses iBeacon UUID as topic, instead of (random) MAC address</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-minimum-rssi-accepted-to-publish-device-data" class="sidebar-link">Setting the minimum RSSI accepted to publish device data</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#store-ble-configuration-into-the-gateway" class="sidebar-link">Store BLE configuration into the gateway</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#read-write-ble-characteristics-over-mqtt" class="sidebar-link">Read/write BLE characteristics over MQTT</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#switchbot-bot-control" class="sidebar-link">SwitchBot Bot control</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#advanced-setting-up-an-external-decoder" class="sidebar-link">ADVANCED: Setting up an external decoder</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#advanced-filtering-out-connectable-devices" class="sidebar-link">ADVANCED: Filtering out connectable devices</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#advanced-advertisement-and-advanced-data-default-false" class="sidebar-link">ADVANCED: Advertisement and advanced data (default: false)</a></li></ul></li><li><a href="/use/ir.html" class="sidebar-link">IR gateway</a></li><li><a href="/use/lora.html" class="sidebar-link">LORA gateway</a></li><li><a href="/use/gsm.html" class="sidebar-link">GSM 2G gateway</a></li><li><a href="/use/rs232.html" class="sidebar-link">RS232 gateway</a></li><li><a href="/use/rfm69.html" class="sidebar-link">RFM69 gateway</a></li><li><a href="/use/sensors.html" class="sidebar-link">Sensors</a></li><li><a href="/use/actuators.html" class="sidebar-link">Actuators</a></li><li><a href="/use/boards.html" class="sidebar-link">Boards</a></li><li><a href="/use/displays.html" class="sidebar-link">Displays</a></li><li><a href="/use/gateway.html" class="sidebar-link">System commands (ESP only)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5 - Integrate 🎉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6 - Participate 💻</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ble-gateway"><a href="#ble-gateway" class="header-anchor">#</a> BLE gateway</h1> <p>The manufacturer agnostic BLE gateway acts as a powerful BLE scanner of devices and decoder, allowing you to visualize and analyze information from a wide range of BLE devices.
It can also act as a presence detection gateway by reading the nearby BLE tags or tracker devices.</p> <p>Data are transmitted to an MQTT broker, where it can be used to trigger events and rules, as well as displayed, stored and processed in your favorite controller.</p> <p>With the ability to monitor and analyze data such as temperature, humidity, moisture, luminance, weight, pressure, fine particles, and more, the BLE gateway provides a flexible and customizable solution for integrating BLE technology into your control and monitoring systems.</p> <p><img src="/assets/img/OpenMQTTGateway-sensors-ble.a3701541.png" alt=""></p> <h2 id="receiving-signals-from-compatible-ble-sensors-to-publish-it-to-an-mqtt-broker"><a href="#receiving-signals-from-compatible-ble-sensors-to-publish-it-to-an-mqtt-broker" class="header-anchor">#</a> Receiving signals from <a href="https://decoder.theengs.io/devices/devices_by_brand.html" target="_blank" rel="noopener noreferrer">compatible BLE sensors<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to publish it to an MQTT broker.</h2> <p>To receive data from BLE sensors you can use an ESP32-based device with a programming USB port or use a Serial adapter.</p> <p>OpenMQTTGateway is also available preloaded and configured with the <a href="https://shop.theengs.io/products/theengs-plug-smart-plug-ble-gateway-and-energy-consumption" target="_blank" rel="noopener noreferrer">Theengs plug<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, a smart plug that acts as a BLE gateway and energy monitoring device.</p> <ol><li><p>Follow the <a href="/upload/web-install.html">Upload</a> and <a href="/upload/portal.html">Configuration</a> steps.</p></li> <li><p>Download an MQTT client like MQTT explorer.</p></li> <li><p>You should see data coming in your broker.</p></li></ol> <p><img src="/assets/img/OpenMQTTGateway-mqtt-explorer-lywsd03mmc-atc.5270b942.png" alt=""></p> <p>Once the data has been transmitted to the MQTT broker, it can be easily integrated with your preferred controller. For example, the data can be automatically discovered and made available within popular controllers, example below with Home Assistant.</p> <p><img src="/assets/img/OpenMQTTGateway-home-assistant-chart.580d5e05.png" alt=""></p> <p>Examples of compatible sensors among [our list](https://decoder.theengs.io/devices/devices_by_brand.html: Mi Flora, Mi jia, LYWDS02, LYWSD03MMC, ClearGrass, Mi scale, iBBQ, TPMS</p> <h2 id="receiving-signals-from-ble-tracker-devices-for-presence-detection"><a href="#receiving-signals-from-ble-tracker-devices-for-presence-detection" class="header-anchor">#</a> Receiving signals from BLE tracker devices for Presence detection</h2> <p>The gateway can detect the BLE trackers from Tile, NUT, TAGIT, ITAG, MiBand, Amazfit and RuuviTag and create automaticaly a device tracker entity following the Home Assistant discovery convention (if the auto discovery is activated).
To do this activate the &quot;BT: Publish HASS presence&quot; switch in your controller or send the followng MQTT command to your broker:
<code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;hasspresence&quot;:true}'</code></p> <p>The entity created can be attached to a person to leverage presence detection. The <code>away</code> or <code>not home</code> state is triggered if the BLE tracker is not detected during the timer defined by <code>presenceawaytimer</code>.</p> <p><img src="/assets/img/OpenMQTTGateway-BLE-tracker-Home-Assistant.4246afef.png" alt=""></p> <p>If you have multiple gateways, your BLE trackers may not be detected temporary by one gateway but still by the others. In this case you will see the tracker appears offline briefly and online again once it is detected by the others gateways.</p> <p>By default <code>presenceawaytimer</code> is set to 120s, you can change it from the slider in your controller or with the following command (ms)</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;presenceawaytimer&quot;:66000}'</code></p> <p>Generally BLE devices will not broadcast if they are paired so you may need to ensure your beacons is unpaired/disconnected before it will be seen by the gateway.</p> <p>Consider the distance estimation as a beta feature.</p> <p>Note that you can find apps to simulate beacons and do some tests like <a href="https://play.google.com/store/apps/details?id=net.alea.beaconsimulator" target="_blank" rel="noopener noreferrer">Beacon simulator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>iOS version &gt;=10 devices advertise without an extra app MAC address, nevertheless this address <a href="https://github.com/1technophile/OpenMQTTGateway/issues/71" target="_blank" rel="noopener noreferrer">changes randomly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and cannot be used for presence detection. You must install an app to advertise a fixed MAC address.</p> <h2 id="setting-a-white-or-black-list"><a href="#setting-a-white-or-black-list" class="header-anchor">#</a> Setting a white or black list</h2> <p>A black list is a list of MAC addresses that will never be published by OMG
to set black list
<code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;black-list&quot;:[&quot;01:23:14:55:16:15&quot;,&quot;4C:65:77:88:9C:79&quot;,&quot;4C:65:A6:66:3C:79&quot;]}'</code></p> <p>A white list is a list of MAC addresses permitted to be published by OMG
to set white list
<code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;white-list&quot;:[&quot;01:23:14:55:16:15&quot;,&quot;4C:65:77:88:9C:79&quot;,&quot;4C:65:A6:66:3C:79&quot;]}'</code></p> <p>Note: if you want to filter (white or black list) on BLE sensors that are auto discovered, you need to wait for the discovery before applying the white or black list, or temporarily disable it:</p> <p>to temporarily disable white/black list
<code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;ignoreWBlist&quot;:true}'</code></p> <p>to enable white/black list back
<code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;ignoreWBlist&quot;:false}'</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>So as to keep your white/black list persistent you can publish it with the retain option of MQTT (-r with mosquitto_pub or retain check box of MQTT Explorer)
<code>mosquitto_pub -r -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;white-list&quot;:[&quot;01:23:14:55:16:15&quot;,&quot;4C:65:77:88:9C:79&quot;,&quot;4C:65:A6:66:3C:79&quot;]}'</code></p></div> <h2 id="setting-the-time-between-ble-scans-and-force-a-scan"><a href="#setting-the-time-between-ble-scans-and-force-a-scan" class="header-anchor">#</a> Setting the time between BLE scans and force a scan</h2> <p>If you want to change the time between readings you can change the interval by MQTT.
For example, if you want the BLE to scan every 66 seconds:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;interval&quot;:66000}'</code></p> <p>you can also force a scan to be done by the following command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;interval&quot;:0}'</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.</p></div> <p>Once the forced scan has completed, the previous scan interval value will be restored. Forcing a scan command trigger also a BLE connect process after the scan (see below).</p> <p>The default value <code>TimeBtwRead</code> is set into config_BT.h or into your .ini file for platformio users.</p> <p>If you want to scan continuously for BLE devices, for example for beacon location you can set the interval to 1ms:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;interval&quot;:1}'</code></p> <p>In this case you should deactivate the BLE connection mechanism to avoid concurrency between scan and connections (see chapter below, bleconnect).</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>For certain devices like LYWSD03MMC OpenMQTTGateway use a connection (due to the fact that the advertized data are encrypted), this connection mechanism is launched after every <code>TimeBtwConnect</code> per default, you can modify it by following the procedure below.</p></div> <h2 id="setting-the-time-between-connection-attempts"><a href="#setting-the-time-between-connection-attempts" class="header-anchor">#</a> Setting the time between connection attempts</h2> <p>If you want to change the time between BLE connect you can change it by MQTT, if you want the BLE connect time to be every 300s:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;intervalcnct&quot;:300000}'</code></p> <h2 id="setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors-default-false"><a href="#setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors-default-false" class="header-anchor">#</a> Setting if the gateway publishes all the BLE devices scanned or only the detected sensors (default: false)</h2> <p>If you want to change this characteristic:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;onlysensors&quot;:true}'</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.</p></div> <p>The gateway will publish only the detected sensors like Mi Flora, Mi jia, LYWSD03MMC... and not the other BLE devices. This is useful if you don't use the gateway for presence detection but only to retrieve sensors data.</p> <h2 id="setting-if-the-gateway-publishes-known-devices-which-randomly-change-their-mac-address"><a href="#setting-if-the-gateway-publishes-known-devices-which-randomly-change-their-mac-address" class="header-anchor">#</a> Setting if the gateway publishes known devices which randomly change their MAC address</h2> <p>The default is false, as such changing MAC addresses cannot be related to specific devices.</p> <p>If you want to change this characteristic:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;randommacs&quot;:true}'</code></p> <h2 id="setting-if-the-gateway-use-adaptive-scanning"><a href="#setting-if-the-gateway-use-adaptive-scanning" class="header-anchor">#</a> Setting if the gateway use adaptive scanning</h2> <p>Adaptive scanning lets the gateway decide for you the best passive <code>interval</code> and active <code>intervalacts</code> scan interval, depending on the characteristics of your devices.
The gateway retrieves your devices' information from <a href="https://decoder.theengs.io" target="_blank" rel="noopener noreferrer">Theengs Decoder<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and adapts its parameters accordingly if a device that requires it is detected.
For example a door or a PIR sensor will require continuous scanning, so if detected the gateway is going to reduce its time between scans to the minimum. Or your devices may also require active scanning to retrieve data, in this case the gateway will also trigger active scans at regular intervals.</p> <p>If you want to change this characteristic (default:true):</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;adaptivescan&quot;:false}'</code></p> <p>Setting Adaptive scanning to <code>false</code> will automatically put the gateway to continuous active scanning if no additional manual changes have already been applied.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.</p></div> <p>An overview with background information to better understand the different setting used:</p> <p><strong>Passive scanning:</strong> With this scanning mode the gateway picks up any freely available broadcasts sent out by devices, without any interaction with the devices. The interval for this is set with <a href="#setting-the-time-between-ble-scans-and-force-a-scan">{&quot;interval&quot;:66000}</a></p> <p><strong>Active scanning:</strong> With this scanning mode the gateway sends out requests for sensor broadcasts first, before then picking up the broadcast advertisement data. Some devices require this request before they send out all data in their broadcasts. The interval for this active scanning with request first is set by <a href="#setting-the-time-between-active-scanning">{&quot;intervalacts&quot;:300000}</a></p> <p>If adaptive scanning is set to false and you want to manually set these intervals, setting <a href="#advanced-publishing-advertisement-and-advanced-data-default-false">Publishing advertisement and advanced data</a> to true will show you additional data about which of your devices require active scanning and/or continuous scanning, so that you can tune these setting to your devices and your individual requirements of their data.</p> <p><strong>&quot;cont&quot;:true</strong> - the device requires continuous scanning. If passive ({&quot;interval&quot;:100}) or active ({&quot;intervalacts&quot;:100}) depends on the additional device specification.</p> <p><strong>&quot;acts&quot;:true</strong> - the device requires active scanning to broadcast all of it's data for decoding.</p> <h2 id="setting-the-time-between-active-scanning"><a href="#setting-the-time-between-active-scanning" class="header-anchor">#</a> Setting the time between active scanning</h2> <p>If you have passive scanning activated, but also have some devices which require active scanning, this defines the time interval between two intermittent active scans.</p> <p>If you want to change the time between active scans you can change it by MQTT. For setting the active scan interval time to every 5 minutes:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;intervalacts&quot;:300000}'</code></p> <h2 id="setting-the-duration-of-a-scan"><a href="#setting-the-duration-of-a-scan" class="header-anchor">#</a> Setting the duration of a scan</h2> <p>If you want to change the default 10 sec duration of each scan cycle to 5 seconds</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;scanduration&quot;:5000}'</code></p> <h2 id="setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32"><a href="#setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32" class="header-anchor">#</a> Setting if the gateway connects to BLE devices eligibles on ESP32</h2> <p>If you want to change this characteristic:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;bleconnect&quot;:false}'</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.</p></div> <h2 id="setting-if-the-gateway-publish-into-home-assistant-home-presence-topic"><a href="#setting-if-the-gateway-publish-into-home-assistant-home-presence-topic" class="header-anchor">#</a> Setting if the gateway publish into Home Assistant Home presence topic</h2> <p>If you want to publish to Home Assistant presence topic, you can activate this function by the HASS interface (this command is auto discovered), <a href="/integrate/home_assistant.html#mqtt-room-presence">here is a yaml example</a>.
Or by an MQTT command.</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;hasspresence&quot;:true}'</code></p> <p>To change presence publication topic, use this MQTT command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;presenceTopic&quot;:&quot;presence/&quot;}'</code></p> <p>To use iBeacon UUID for presence, instead of sender (random) MAC address, use this MQTT command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;presenceUseBeaconUuid&quot;:true}'</code></p> <p>This will change usual payload for iBeacon from:
<code>{&quot;id&quot;:&quot;60:87:57:4C:9B:C2&quot;,&quot;mac_type&quot;:1,&quot;rssi&quot;:-78,&quot;distance&quot;:7.85288,&quot;brand&quot;:&quot;GENERIC&quot;,&quot;model&quot;:&quot;iBeacon&quot;,&quot;model_id&quot;:&quot;IBEACON&quot;,&quot;mfid&quot;:&quot;4c00&quot;,&quot;uuid&quot;:&quot;1de4b189115e45f6b44e509352269977&quot;,&quot;major&quot;:0,&quot;minor&quot;:0,&quot;txpower&quot;:-66}</code>
To:
<code>{&quot;id&quot;:&quot;1de4b189115e45f6b44e509352269977&quot;,&quot;mac_type&quot;:1,&quot;rssi&quot;:-78,&quot;distance&quot;:7.85288,&quot;brand&quot;:&quot;GENERIC&quot;,&quot;model&quot;:&quot;iBeacon&quot;,&quot;model_id&quot;:&quot;IBEACON&quot;,&quot;mfid&quot;:&quot;4c00&quot;,&quot;uuid&quot;:&quot;1de4b189115e45f6b44e509352269977&quot;,&quot;major&quot;:0,&quot;minor&quot;:0,&quot;txpower&quot;:-66,&quot;mac&quot;:&quot;60:87:57:4C:9B:C2&quot;}</code>
Note: the MAC address is put in &quot;mac&quot; field.</p> <h2 id="setting-if-the-gateway-uses-ibeacon-uuid-as-topic-instead-of-random-mac-address"><a href="#setting-if-the-gateway-uses-ibeacon-uuid-as-topic-instead-of-random-mac-address" class="header-anchor">#</a> Setting if the gateway uses iBeacon UUID as topic, instead of (random) MAC address</h2> <p>By default, iBeacon are published like other devices, using a topic based on the MAC address of the sender.
But modern phones randomize their Bluetooth MAC address making it difficult to track iBeacon.</p> <p>For example, the 2 following messages corresponds to the same iBeacon, but with different MAC and topics:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>home/OpenMQTTGateway/BTtoMQTT/58782076BC24 {&quot;id&quot;:&quot;58:78:20:76:BC:24&quot;,&quot;mac_type&quot;:1,&quot;rssi&quot;:-79,&quot;brand&quot;:&quot;GENERIC&quot;,&quot;model&quot;:&quot;iBeacon&quot;,&quot;model_id&quot;:&quot;IBEACON&quot;,&quot;mfid&quot;:&quot;4c00&quot;,&quot;uuid&quot;:&quot;1de4b189115e45f6b44e509352269977&quot;,&quot;major&quot;:0,&quot;minor&quot;:0,&quot;txpower&quot;:-66}
home/OpenMQTTGateway/BTtoMQTT/5210A84690AC {&quot;id&quot;:&quot;52:10:A8:46:90:AC&quot;,&quot;mac_type&quot;:1,&quot;rssi&quot;:-77,&quot;brand&quot;:&quot;GENERIC&quot;,&quot;model&quot;:&quot;iBeacon&quot;,&quot;model_id&quot;:&quot;IBEACON&quot;,&quot;mfid&quot;:&quot;4c00&quot;,&quot;uuid&quot;:&quot;1de4b189115e45f6b44e509352269977&quot;,&quot;major&quot;:0,&quot;minor&quot;:0,&quot;txpower&quot;:-66}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>To use iBeacon UUID as topic, use this MQTT command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;pubBeaconUuidForTopic&quot;:true}'</code></p> <p>Resulting in such messages (for the same iBeacon as previously):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>home/OpenMQTTGateway/BTtoMQTT/1de4b189115e45f6b44e509352269977 {&quot;id&quot;:&quot;52:10:A8:46:90:AC&quot;,&quot;mac_type&quot;:1,&quot;rssi&quot;:-76,&quot;brand&quot;:&quot;GENERIC&quot;,&quot;model&quot;:&quot;iBeacon&quot;,&quot;model_id&quot;:&quot;IBEACON&quot;,&quot;mfid&quot;:&quot;4c00&quot;,&quot;uuid&quot;:&quot;1de4b189115e45f6b44e509352269977&quot;,&quot;major&quot;:0,&quot;minor&quot;:0,&quot;txpower&quot;:-66}
home/OpenMQTTGateway/BTtoMQTT/1de4b189115e45f6b44e509352269977 {&quot;id&quot;:&quot;7B:63:C6:82:DC:57&quot;,&quot;mac_type&quot;:1,&quot;rssi&quot;:-83,&quot;brand&quot;:&quot;GENERIC&quot;,&quot;model&quot;:&quot;iBeacon&quot;,&quot;model_id&quot;:&quot;IBEACON&quot;,&quot;mfid&quot;:&quot;4c00&quot;,&quot;uuid&quot;:&quot;1de4b189115e45f6b44e509352269977&quot;,&quot;major&quot;:0,&quot;minor&quot;:0,&quot;txpower&quot;:-66}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="setting-the-minimum-rssi-accepted-to-publish-device-data"><a href="#setting-the-minimum-rssi-accepted-to-publish-device-data" class="header-anchor">#</a> Setting the minimum RSSI accepted to publish device data</h2> <p>If you want to change the minimum RSSI value accepted for a device to be published, you can change it by MQTT. For example if you want to set -80</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;minrssi&quot;:-80}'</code></p> <p>you can also accept all the devices by the following command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;minrssi&quot;:-200}'</code></p> <p>The default value is set into config_BT.h</p> <h2 id="store-ble-configuration-into-the-gateway"><a href="#store-ble-configuration-into-the-gateway" class="header-anchor">#</a> Store BLE configuration into the gateway</h2> <p>Open MQTT Gateway has the capability to save the current configuration and reload it at startup.</p> <p>To store the running configuration into the gateway, use the command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;save&quot;:true}'</code></p> <p>At any time, you can reload the stored configuration with the command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;load&quot;:true}'</code></p> <p>If you want to erase the stored configuration, use the command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;erase&quot;:true}'</code>
Note that it will not change the running configuration, only ensure default configuration is used at next startup.</p> <p>By the way, if you want to load the default built-in configuration (on any board, not only ESP32), use the command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;init&quot;:true}'</code>
Note that it will not change the stored configuration, <code>erase</code> or <code>save</code> is still needed to overwrite the saved configuration.</p> <h2 id="read-write-ble-characteristics-over-mqtt"><a href="#read-write-ble-characteristics-over-mqtt" class="header-anchor">#</a> Read/write BLE characteristics over MQTT</h2> <p>The gateway can read and write BLE characteristics from devices and provide the results in an MQTT message.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>These actions will be taken on the next BLE connection, which occurs after scanning and after the scan count is reached, <a href="#setting-the-number-of-scans-between-connection-attempts">see above to set this</a>.
This can be overridden by providing an (optional) parameter <code>&quot;immediate&quot;: true</code> within the command. This will cause the BLE scan to stop if currently in progress, allowing the command to be immediately processed. All other connection commands in queue will also be processed for the same device, commands for other devices will be deferred until the next normally scheduled connection.</p> <p><strong>Note</strong> Some devices need to have the MAC address type specified. You can find this type by checking the log/MQTT data and looking for &quot;mac_type&quot;. The mac_type of your device can be seen by setting <code>pubadvdata</code> to <code>true</code> with an MQTT command (see Publishing advertisement data), or with the macro <code>pubBLEAdvData true</code>. By default the type is 0 but some devices use different type values. You must specify the correct type to connect successfully.<br>
To specify the MAC address type add the parameter <code>&quot;mac_type&quot;</code> to the command. For example <code>&quot;mac_type&quot;: 1</code> to connect with a device with the MAC address type of 1.</p></div> <h3 id="example-write-command"><a href="#example-write-command" class="header-anchor">#</a> Example write command</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{
  &quot;ble_write_address&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;ble_write_service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;ble_write_char&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;ble_write_value&quot;:&quot;TEST&quot;,
  &quot;value_type&quot;:&quot;STRING&quot;,
  &quot;ttl&quot;:4,
  &quot;immediate&quot;:true }'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Response:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;id&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;characteristic&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;write&quot;:&quot;TEST&quot;,
  &quot;success&quot;:true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="example-read-command"><a href="#example-read-command" class="header-anchor">#</a> Example read command</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{
  &quot;ble_read_address&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;ble_read_service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;ble_read_char&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;value_type&quot;:&quot;STRING&quot;,
  &quot;ttl&quot;: 2 }'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Response:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;id&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;characteristic&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;read&quot;:&quot;TEST&quot;,
  &quot;success&quot;:true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The <code>ttl</code> parameter is the number of attempts to connect (defaults to 1), which occur after the BLE scan completes.<br> <code>value_type</code> can be one of: STRING, HEX, INT, FLOAT. Default is STRING if omitted in the message.</p></div> <h2 id="switchbot-bot-control"><a href="#switchbot-bot-control" class="header-anchor">#</a> SwitchBot Bot control</h2> <p>SwitchBot Bot devices are automatically discovered and available as a device in the configuration menu of home assistant.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If the SwitchBot mode is changed the ESP32 must be restarted.</p></div> <p>The device can also be controlled over MQTT with a simplified BLE write command.</p> <h3 id="example-command-to-set-the-switchbot-state-to-on"><a href="#example-command-to-set-the-switchbot-state-to-on" class="header-anchor">#</a> Example command to set the SwitchBot state to ON:</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{
  &quot;SBS1&quot;:&quot;on&quot;,
  &quot;mac&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;
}'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Response (assuming success):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;id&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;state&quot;:&quot;on&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="advanced-setting-up-an-external-decoder"><a href="#advanced-setting-up-an-external-decoder" class="header-anchor">#</a> ADVANCED: Setting up an external decoder</h2> <p>This advanced option is used to publish raw radio frames on a specific topic to be decoded by an external decoder instead of the integrated one.</p> <p>To enable external decoder:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;extDecoderEnable&quot;:true}'</code></p> <p>To change the default external decoder topic to &quot;undecoded&quot;:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;extDecoderTopic&quot;:&quot;undecoded&quot;}'</code></p> <h2 id="advanced-filtering-out-connectable-devices"><a href="#advanced-filtering-out-connectable-devices" class="header-anchor">#</a> ADVANCED: Filtering out connectable devices</h2> <p><a href="/integrate/openhab2.html">With OpenHAB integration</a>, this configuration is highly recommended, otherwise you may encounter incomplete data.</p> <p>If you want to enable this feature:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;filterConnectable&quot;:true}'</code></p> <h2 id="advanced-advertisement-and-advanced-data-default-false"><a href="#advanced-advertisement-and-advanced-data-default-false" class="header-anchor">#</a> ADVANCED: Advertisement and advanced data (default: false)</h2> <p>If you want to enable this feature:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;pubadvdata&quot;:true}'</code></p> <p>This will publish extensive information about the device:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;11:22:33:44:55:66&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;mac_type&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;adv_type&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Qingping Motion &amp; Light&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rssi&quot;</span><span class="token operator">:</span><span class="token number">-93</span><span class="token punctuation">,</span><span class="token property">&quot;servicedata&quot;</span><span class="token operator">:</span><span class="token string">&quot;88121122334455660201520f0126090403000000&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;servicedatauuid&quot;</span><span class="token operator">:</span><span class="token string">&quot;0xfdcd&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;brand&quot;</span><span class="token operator">:</span><span class="token string">&quot;Qingping&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;model&quot;</span><span class="token operator">:</span><span class="token string">&quot;Motion &amp; Light&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;model_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;CGPR1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;lux&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;batt&quot;</span><span class="token operator">:</span><span class="token number">82</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To stop publishing advertisement data:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;pubadvdata&quot;:false}'</code></p> <div class="custom-block warning"><p class="custom-block-title">Note</p> <p>All product and company names are trademarks or registered trademarks of their respective holders. Use of them does not imply any affiliation with or endorsement by them.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>We strongly encourage the use of a white-list (see below) so as to collect data from your devices only and not from other MAC addresses.
By default the gateway scans the advertizing BLE devices nearby with their MAC addresses. Depending on your country, it may be illegal to monitor networks for MAC addresses, especially on networks that you do not own. Please check your country's laws (for US Section 18 U.S. Code § 2511) - <a href="https://github.com/schollz/howmanypeoplearearound/issues/4" target="_blank" rel="noopener noreferrer">discussion here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/1technophile/OpenMQTTGateway/edit/development/docs/use/ble.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/22/2023, 6:51:18 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/use/rf.html" class="prev">
        RF gateways  (433mhz/315mhz)
      </a></span> <span class="next"><a href="/use/ir.html">
        IR gateway
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a95c5609.js" defer></script><script src="/assets/js/2.42b808dd.js" defer></script><script src="/assets/js/9.ff7eeaa8.js" defer></script>
  </body>
</html>
